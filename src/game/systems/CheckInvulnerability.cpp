/*
** EPITECH PROJECT, 2023
** r-type
** File description:
** CheckDamage
*/
#include "Rtype/systems/CheckInvulnerability.hpp"
#include "RNGine/addons/Collider.hpp"
#include "RNGine/components/Attackable.hpp"
#include "Rtype/addons/MakeDamage.hpp"
#include <iostream>

void Client::Systems::CheckInvulnerability(RNGine::Core &core) {
  auto &scene = core.GetActualScene();
  auto &Attackables = scene.GetComponents<RNGine::Components::Attackable>();

  for (size_t i = 0; i < Attackables.size(); i++) {
    if (!Attackables[i].has_value())
      continue;
    if (std::chrono::duration_cast<std::chrono::milliseconds>(
            std::chrono::system_clock::now().time_since_epoch())
                .count() -
            Attackables[i]->lastShoot >
        Attackables[i]->invinsibilityTime) {
      Attackables[i]->_Attackable = true;
      Attackables[i]->lastShoot =
          std::chrono::duration_cast<std::chrono::milliseconds>(
              std::chrono::system_clock::now().time_since_epoch())
              .count();
    }
  }
}
